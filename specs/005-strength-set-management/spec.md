# Feature Specification: 筋トレのセット管理の見直し

**Feature Branch**: `005-strength-set-management`
**Created**: 2026-01-02
**Status**: Draft
**Input**: User description: "筋トレのセット管理の見直し"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - セットごとの記録入力 (Priority: P1)

ユーザーは筋トレの各セットを個別に記録したい。例えばショルダープレスで1セット目は25kg×15回、2セット目以降は45kg×15回のように、セットごとに異なる重量・回数を記録できる。

**Why this priority**: 現在の「3セット×10回×45kg」のサマリー形式では、実際のトレーニングを正確に記録できない。セットごとの記録が筋トレ管理の基本となる。

**Independent Test**: 1つの種目に対して複数セットを追加・保存し、各セットの重量・回数が正しく保存・表示されることを確認できる。

**Acceptance Scenarios**:

1. **Given** 運動記録画面で種目を選択した状態、**When** 「セット追加」ボタンをタップ、**Then** 新しいセット入力行が追加される
2. **Given** セット入力行がある状態、**When** 重量と回数を入力して保存、**Then** そのセットが記録される
3. **Given** 複数セットを入力した状態、**When** 保存ボタンをタップ、**Then** すべてのセットがまとめて保存される

---

### User Story 2 - 種目別グループ表示 (Priority: P1)

ユーザーは記録した運動を種目ごとにグループ化して確認したい。同じ日に記録したショルダープレスの全セットが1つのカードにまとまり、セット番号・重量・回数・推定RM等が一覧表示される。

**Why this priority**: セットごとの記録を見やすく表示することで、トレーニングの振り返りが容易になる。入力機能と表示機能は同時に必要。

**Independent Test**: 複数セット記録後に運動一覧を開き、種目ごとにグループ化されてセット詳細が表示されることを確認できる。

**Acceptance Scenarios**:

1. **Given** ショルダープレス5セットを記録済み、**When** 運動一覧を表示、**Then** 「ショルダープレス」カード内に5セット分の詳細が表示される
2. **Given** 種目カードを表示中、**When** 各セット行を確認、**Then** セット番号・重量(kg/lbs)・回数・推定RMが表示される

---

### User Story 3 - 推定1RM自動計算 (Priority: P2)

ユーザーは各セットの推定1RM（1回だけ挙げられる最大重量）を自動計算で確認したい。重量と回数から推定RMを算出し表示することで、トレーニング強度の把握に役立つ。

**Why this priority**: RM計算は筋トレ管理の標準機能だが、入力・表示機能が先に必要。

**Independent Test**: セットを記録した際に推定RMが自動計算され、一覧画面で各セットのRM値が表示されることを確認できる。

**Acceptance Scenarios**:

1. **Given** 45kg×15回を入力、**When** 保存、**Then** 推定RM（約62kg）が計算・表示される
2. **Given** 自重トレーニング（重量なし）、**When** 保存、**Then** RM表示はスキップされる

---

### User Story 4 - バリエーション記録 (Priority: P3)

ユーザーはレッグプレスの「ワイド」「ナロウ」「ベーシック」のように、同じ種目でも異なるバリエーションを記録したい。

**Why this priority**: バリエーション記録は便利だが、基本のセット管理が先に必要。

**Independent Test**: セット入力時にバリエーションを選択または入力し、一覧で表示されることを確認できる。

**Acceptance Scenarios**:

1. **Given** レッグプレスのセット入力中、**When** バリエーション「ワイド」を選択、**Then** そのセットに「ワイド」が関連付けられる
2. **Given** バリエーション付きセットを保存済み、**When** 一覧表示、**Then** セット行にバリエーション名が表示される

---

### User Story 5 - 過去のトレーニングを取り込む (Priority: P2)

ユーザーはトレーニングメニューを定期的に変更するため、前回だけでなく過去の複数セッションから選んで取り込みたい。例えば「胸の日」「背中の日」「脚の日」のようにローテーションしている場合、該当するセッションを選択できる。

**Why this priority**: 同じトレーニングを繰り返すユーザーにとって入力時間を大幅に短縮できる重要な機能。セット管理機能の完成後に実装。

**Independent Test**: 過去の複数セッションから1つを選択して取り込み、同じ種目・セット構成が新規入力として反映されることを確認できる。

**Acceptance Scenarios**:

1. **Given** 運動記録画面、**When** 「過去のトレーニングから取り込む」ボタンをタップ、**Then** 直近のトレーニングセッション一覧（日付・種目サマリー）が表示される
2. **Given** セッション一覧が表示された状態、**When** 3日前のセッションを選択、**Then** そのセッションの全種目・セットが取り込まれる
3. **Given** 過去にショルダープレス5セットを記録済み、**When** その記録から「取り込む」をタップ、**Then** 同じ種目・重量・回数で5セット分の入力フォームが表示される
4. **Given** 取り込んだセットが表示された状態、**When** 重量を変更して保存、**Then** 変更後の値で新規記録として保存される
5. **Given** セッション一覧、**When** スクロール、**Then** さらに古いセッションが読み込まれる（無限スクロール）

---

### Edge Cases

- 重量0または空欄の場合：自重トレーニングとして扱い、RM計算はスキップする
- セットを0件で保存しようとした場合：エラーメッセージを表示し保存しない
- 既存データの移行：現在の「セット数サマリー」形式のデータは、同一の重量・回数で複数セットに展開する
- **セット削除時の挙動**: セット番号を自動で振り直す（例: 1,2,4 → 1,2,3）

## Clarifications

### Q1: セット削除時の挙動
**質問**: セットを削除した場合、残りのセット番号をどう扱うか？
**回答**: セット番号を自動で振り直す（1,2,4 → 1,2,3）。ギャップを残さない。

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは種目ごとに複数のセットを個別に記録できなければならない
- **FR-002**: 各セットは重量（kg）、回数（レップ）、セット番号を持たなければならない
- **FR-003**: 各セットにオプションでバリエーション（ワイド、ナロウ等）を記録できなければならない
- **FR-004**: システムは重量と回数からEpleyの公式（RM = weight × (1 + reps/30)）で推定1RMを計算しなければならない
- **FR-005**: 運動記録の一覧は種目ごとにグループ化して表示しなければならない
- **FR-006**: 各種目のグループ内でセットは番号順に表示しなければならない
- **FR-007**: 重量はkgとlbs両方で表示しなければならない（1kg = 2.205lbs）
- **FR-008**: ユーザーは種目カード内で「+」ボタンからセットを追加できなければならない
- **FR-009**: 既存の「セット数サマリー」形式のデータは新形式に移行できなければならない
- **FR-010**: ユーザーは過去のトレーニング記録を取り込んで新規入力のテンプレートとして使用できなければならない
- **FR-011**: 取り込んだセットは編集可能で、変更後に新規記録として保存できなければならない

### Key Entities

- **ExerciseSet**: 1つのセットを表す。種目名、セット番号、重量、回数、バリエーション、記録日時、推定RMを持つ
- **ExerciseGroup**: 表示用の概念。同じ日・同じ種目のセットをグループ化したもの

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ユーザーは1種目あたり10セット以上を30秒以内に記録できる
- **SC-002**: 種目別グループ表示で、1日のトレーニング内容を5秒以内に把握できる
- **SC-003**: 推定RM計算の精度がEpley公式と一致する（誤差1%以内）
- **SC-004**: 既存データの移行が100%完了し、データ損失がない
