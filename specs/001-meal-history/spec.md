# Feature Specification: 食事記録の日付別表示

**Feature Branch**: `001-meal-history`
**Created**: 2026-01-05
**Status**: Draft
**Input**: User description: "Issue #23 - 食事記録が日毎に確認できるようになっていない。現在はすべての過去の食事が並んでいるが、メインページにはその日の食事のみを表示し、それ以外の日の食事は別ページで確認できるようにすべき"

## Clarifications

### Session 2026-01-05

- Q: 履歴ページの日付ナビゲーション方式は？ → A: カレンダー形式のみ（月表示で日付をタップして選択）

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 今日の食事のみ表示 (Priority: P1)

ユーザーとして、食事ページを開いた時に今日の食事記録のみが表示されることで、その日の食事管理に集中できる。

**Why this priority**: これが問題の核心であり、最も重要なユーザー体験の改善。現在は全ての過去データが混在しており、当日の管理が困難。

**Independent Test**: 食事ページを開き、今日の日付の記録のみが表示されていることを確認する。これだけで主要な価値（当日の食事管理への集中）が提供される。

**Acceptance Scenarios**:

1. **Given** ユーザーが食事ページを開く, **When** ページが読み込まれる, **Then** 今日の食事記録のみが「記録履歴」セクションに表示される
2. **Given** ユーザーが今日複数の食事を記録している, **When** 食事ページを表示する, **Then** 朝食・昼食・夕食・間食がすべて今日の日付のものだけ表示される
3. **Given** ユーザーが今日の食事を記録していない, **When** 食事ページを表示する, **Then** 「今日の記録はありません」というメッセージが表示される

---

### User Story 2 - 過去の食事履歴の閲覧 (Priority: P2)

ユーザーとして、過去の食事記録を別のページで日付別に確認できることで、食習慣の振り返りができる。

**Why this priority**: 過去データへのアクセスは重要だが、メインの食事管理機能（P1）が先に必要。

**Independent Test**: 食事履歴ページに移動し、過去の日付を選択して、その日の食事記録を確認できる。

**Acceptance Scenarios**:

1. **Given** ユーザーが食事ページにいる, **When** 「過去の記録を見る」リンクをタップする, **Then** 食事履歴ページに遷移する
2. **Given** ユーザーが食事履歴ページにいる, **When** 日付を選択する, **Then** 選択した日付の食事記録が表示される
3. **Given** ユーザーが過去の食事を確認している, **When** メイン食事ページに戻る, **Then** 再び今日の食事のみが表示される

---

### User Story 3 - 月間カレンダー表示 (Priority: P3)

ユーザーとして、月間カレンダーで過去の食事記録がある日を確認できることで、記録した日を簡単に見つけられる。

**Why this priority**: ナビゲーション改善は便利だが、基本機能（P1, P2）が動作した後の改善項目。

**Independent Test**: 食事履歴ページの月間カレンダーで記録がある日が視覚的に識別でき、タップして詳細を確認できる。

**Acceptance Scenarios**:

1. **Given** ユーザーが食事履歴ページにいる, **When** 月間カレンダーを見る, **Then** 食事記録がある日が視覚的に区別される（例：ドットやハイライト表示）
2. **Given** 記録がある日を見つける, **When** その日付をタップする, **Then** その日の食事一覧が表示される
3. **Given** ユーザーが食事履歴ページにいる, **When** 前月/翌月ボタンをタップする, **Then** カレンダーが該当月に切り替わる

---

### Edge Cases

- 本日の最初の食事記録時（まだ記録がない状態からの記録追加）
- タイムゾーンが異なる場所で記録した場合の「今日」の判定
- 日付をまたいでアプリを開き続けた場合の表示更新
- 過去に大量の記録（100日以上）がある場合のパフォーマンス

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 食事ページの「記録履歴」セクションには、今日の日付の食事記録のみを表示する
- **FR-002**: 今日の記録がない場合は、適切な空状態メッセージを表示する
- **FR-003**: 食事ページから過去の食事履歴ページへのナビゲーションリンクを提供する
- **FR-004**: 食事履歴ページでは日付を指定して、その日の食事記録を閲覧できる
- **FR-005**: 食事履歴ページから各食事の詳細ページへ遷移できる（既存機能を維持）
- **FR-006**: 日付の判定はユーザーのローカルタイムゾーンに基づいて行う
- **FR-007**: 食事履歴ページでは月間カレンダーを表示し、記録がある日を視覚的に識別できる
- **FR-008**: 月間カレンダーは前月/翌月へのナビゲーション機能を持つ

### Key Entities

- **MealRecord**: 既存の食事記録エンティティ。recordedAt属性を使用して日付フィルタリングを行う
- **DateFilter**: 日付範囲を指定するためのフィルター。今日/特定日/日付範囲に対応

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 食事ページの読み込み時間が現在と同等以下を維持（今日の記録のみ取得するため改善の可能性あり）
- **SC-002**: ユーザーが今日の食事記録を2回以下のタップで確認できる
- **SC-003**: ユーザーが過去の特定日の食事記録を3回以下のタップで確認できる
- **SC-004**: 1年分の食事記録（約1000件）があるユーザーでも、履歴ページが3秒以内に表示される

## Assumptions

- 既存のuseMealsフックは既にstartDate/endDateフィルターをサポートしているため、バックエンド変更は最小限
- タイムゾーン処理は既存の実装（timezoneOffset送信）を活用する
- 食事履歴ページは新規ページとして追加する（既存ページの大幅改修ではなく）
- カレンダーUIは日付選択に十分な機能を持つシンプルなものとする
