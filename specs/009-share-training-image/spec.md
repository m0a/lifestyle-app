# Feature Specification: トレーニング内容の画像共有機能

**Feature Branch**: `009-share-training-image`
**Created**: 2026-01-02
**Status**: Draft
**Input**: User description: "筋トレについて毎日トレーナーに報告している。その日のトレーニング内容を画像化してxやLINEに共有するようにできますか？スマホから共有するイメージです"

## Reference Image

参考画像として「筋トレMEMO」の共有画像レイアウトを採用：
- ヘッダー: 日付 + "WorkOut" タイトル
- 種目ごとのカード形式（枠線で囲む）
- 各種目にRM（推定最大重量）表示
- セットごとに「番号 重量kg × 回数 reps (1RM:計算値)」形式
- 自己ベスト更新時は「MAX RM」タグを表示
- フッター: アプリ名表示

## User Scenarios & Testing *(mandatory)*

### User Story 1 - トレーニング内容を画像として生成する (Priority: P1)

ユーザーは、その日に記録した筋トレの内容（種目、セット数、回数、重量）を見やすいカード形式の画像として生成できる。これにより、トレーナーへの報告が視覚的にわかりやすくなる。

**Why this priority**: トレーナーへの報告という主要ユースケースの根幹となる機能。画像がなければ共有も意味をなさない。

**Independent Test**: トレーニング記録詳細画面から「画像を作成」ボタンをタップし、記録内容がカード形式の画像としてプレビュー表示されることを確認できる。

**Acceptance Scenarios**:

1. **Given** ユーザーがその日のトレーニングを記録済み, **When** 「画像を作成」ボタンをタップ, **Then** トレーニング内容がカード形式の画像としてプレビュー表示される
2. **Given** プレビュー画像が表示されている, **When** 画像の内容を確認, **Then** 日付、種目名、各セットの重量×回数、推定RM値が視認しやすいレイアウトで表示されている
3. **Given** 複数種目のトレーニングを記録済み, **When** 画像を生成, **Then** すべての種目が1枚の画像にまとめてカード形式で表示される
4. **Given** セットで自己ベストを更新した, **When** 画像を生成, **Then** 該当セットに「MAX RM」のようなハイライト表示がされる

---

### User Story 2 - 生成した画像をSNSやメッセージアプリに共有する (Priority: P1)

ユーザーは、生成したトレーニング画像をスマホの標準共有機能を使ってX（Twitter）、LINE、その他のアプリに送信できる。

**Why this priority**: トレーナーへの報告という目的を達成するための必須機能。画像生成と同等の重要度。

**Independent Test**: プレビュー画面から「共有」ボタンをタップし、スマホの共有シート（iOS: Share Sheet、Android: Intent Chooser）が表示され、任意のアプリを選択して共有できることを確認する。

**Acceptance Scenarios**:

1. **Given** トレーニング画像のプレビューが表示されている, **When** 「共有」ボタンをタップ, **Then** スマホのネイティブ共有シートが表示される
2. **Given** 共有シートが表示されている, **When** LINEを選択, **Then** LINEアプリが開き画像が添付された状態になる
3. **Given** 共有シートが表示されている, **When** Xを選択, **Then** X（Twitter）アプリが開き画像が添付された投稿作成画面になる

---

### User Story 3 - トレーニング画像をダウンロード保存する (Priority: P2)

ユーザーは、生成したトレーニング画像をスマホの写真アルバム/ギャラリーに保存できる。共有せずに記録として残したい場合や、後で別の方法で共有したい場合に使用する。

**Why this priority**: 共有機能で代替可能だが、画像を直接保存したいニーズも一定数存在する。

**Independent Test**: プレビュー画面から「保存」ボタンをタップし、スマホの写真アプリに画像が保存されていることを確認する。

**Acceptance Scenarios**:

1. **Given** トレーニング画像のプレビューが表示されている, **When** 「保存」ボタンをタップ, **Then** 画像がスマホのフォトライブラリに保存される
2. **Given** 画像を保存した, **When** スマホの写真アプリを開く, **Then** 保存したトレーニング画像が確認できる

---

### Edge Cases

- トレーニング記録がない日に画像生成しようとした場合はどうなるか？→「記録がありません」メッセージを表示
- 非常に多くの種目（10種目以上）を記録した場合、画像のレイアウトはどうなるか？→スクロールせずに収まるよう自動的にフォントサイズや余白を調整
- オフライン時に画像生成・共有できるか？→ローカルで画像生成可能、共有はネットワーク接続が必要
- 共有がキャンセルされた場合どうなるか？→プレビュー画面に戻り、再度共有可能

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: System MUST トレーニング記録をカード形式の画像として生成できる
- **FR-002**: System MUST 生成する画像に日付、種目名、各セットの重量×回数を含める
- **FR-003**: System MUST 各セットの推定1RM値を計算して表示する
- **FR-004**: System MUST 種目ごとのRM（推定最大重量）を表示する
- **FR-005**: System MUST 自己ベスト更新セットを「MAX RM」等でハイライト表示する
- **FR-006**: System MUST Web Share APIを使用してスマホのネイティブ共有機能を呼び出せる
- **FR-007**: System MUST 生成した画像をスマホのフォトライブラリに保存できる
- **FR-008**: Users MUST be able to トレーニング詳細画面から画像生成機能にアクセスできる
- **FR-009**: System MUST 画像生成前にプレビューを表示する
- **FR-010**: System MUST 複数種目のトレーニングを1枚の画像にまとめて表示できる

### Key Entities

- **TrainingImage**: 生成されるトレーニング画像。日付、種目カードリスト、フッターを含む
- **ExerciseCard**: 種目ごとのカード。種目名、RM値、セットリストを含む
- **SetDetail**: 各セットの詳細。セット番号、重量、回数、推定1RM、MAX RMフラグを含む
- **ExerciseRecord**: 既存のトレーニング記録エンティティ。画像生成の元データとなる

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ユーザーがトレーニング記録から画像生成・共有を5タップ以内で完了できる
- **SC-002**: 画像生成処理が2秒以内に完了する
- **SC-003**: 生成された画像がX、LINEで正常に表示・投稿できる
- **SC-004**: ユーザーの80%以上がトレーナーへの報告に本機能を使用する（機能リリース後1ヶ月で測定）

## Scope

### In Scope

- その日のトレーニング記録を画像化する機能
- 参考画像のようなカード形式レイアウト（日付ヘッダー、種目カード、セット詳細、フッター）
- 各セットの推定1RM計算と表示
- 自己ベスト更新時のMAX RMハイライト表示
- Web Share APIによるネイティブ共有機能の実装
- 画像のローカル保存機能

### Out of Scope

- 複数日のトレーニングをまとめた画像生成
- 体重・食事記録の画像化
- SNSへの直接投稿（API連携）
- 画像のカスタマイズ（色、フォント、テンプレート選択）
- 動画形式での出力
- 有酸素運動の画像化（筋トレ記録のみ対象）

## Assumptions

- ユーザーは既にトレーニング記録機能を使用しており、記録データが存在する
- スマホ（iOS/Android）のPWAとして動作し、Web Share APIがサポートされている環境を想定
- 画像は参考画像（筋トレMEMO）のようなシンプルで見やすいカード形式を採用
- トレーナーへの共有はXやLINEなど既存のSNS/メッセージアプリを介して行う
- 1RM計算はEpleyの公式（1RM = 重量 × (1 + 回数/30)）等の標準的な計算式を使用
- MAX RMの判定は、該当種目の過去記録と比較して自己ベストかどうかで判断
