# Feature Specification: 栄養素サマリー表示

**Feature Branch**: `013-nutrient-summary`
**Created**: 2026-01-04
**Status**: Draft
**Input**: User description: "カロリー以外の栄養素（たんぱく質など）も計算・表示する機能" (GitHub Issue #14)

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 日次栄養素サマリーの確認 (Priority: P1)

ユーザーとして、食事一覧ページで今日の栄養素（たんぱく質・脂質・炭水化物）の合計を確認したい。現在はカロリーのみ表示されているが、マクロ栄養素の合計も見たい。

**Why this priority**: カロリー管理と同様に、筋トレや体重管理をしているユーザーにとってたんぱく質の総摂取量を把握することは最も重要。これが機能の核心。

**Independent Test**: 食事一覧ページにアクセスし、今日記録した食事の栄養素合計（カロリー・たんぱく質・脂質・炭水化物）がすべて表示されることを確認できる。

**Acceptance Scenarios**:

1. **Given** ユーザーが今日3食を記録している, **When** 食事一覧ページを開く, **Then** カロリー合計に加えて、たんぱく質・脂質・炭水化物の1日合計がそれぞれ表示される
2. **Given** ユーザーが今日まだ食事を記録していない, **When** 食事一覧ページを開く, **Then** 各栄養素の合計が0（または「未記録」）と表示される
3. **Given** ユーザーが栄養素データのない食事（手動入力でカロリーのみ）を記録している, **When** 食事一覧ページを開く, **Then** 栄養素データがある食事のみが合計に含まれ、正しく計算される

---

### User Story 2 - ダッシュボードでの栄養素確認 (Priority: P2)

ユーザーとして、ダッシュボードの食事サマリーカードでも栄養素の合計を確認したい。

**Why this priority**: ダッシュボードは全体の健康状態を一目で把握する場所。カロリーと一緒に栄養素も表示されると便利だが、詳細な確認は食事ページで行うため優先度は2番目。

**Independent Test**: ダッシュボードページにアクセスし、食事サマリーカードに栄養素の合計が表示されることを確認できる。

**Acceptance Scenarios**:

1. **Given** ユーザーがダッシュボードを表示している, **When** 食事サマリーカードを見る, **Then** カロリー合計に加えて、たんぱく質・脂質・炭水化物の合計も表示される

---

### User Story 3 - 食事タイプ別の栄養素確認 (Priority: P3) **[DEFERRED - 将来の拡張]**

ユーザーとして、朝食・昼食・夕食・間食ごとの栄養素の内訳を確認したい。

**Why this priority**: より詳細な分析のための機能。日次合計が確認できれば十分な場合が多いが、栄養バランスの改善には食事タイプ別の把握も役立つ。

**Deferral Reason**: P1/P2で核心機能（日次栄養素合計表示）を先に提供し、ユーザー価値を早期に届ける。タイプ別内訳は次フェーズで検討。

---

### Edge Cases

- 栄養素データがnull（手動入力でカロリーのみ登録）の食事がある場合、その食事は栄養素合計に0として扱う
- すべての食事が栄養素データを持たない場合の表示（合計0gと表示）
- 非常に大きな数値の場合の表示形式（数値はそのまま表示、単位はg）

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは、今日の食事記録から栄養素（たんぱく質・脂質・炭水化物）の合計を計算できなければならない
- **FR-002**: システムは、食事一覧ページの日次サマリーでカロリーカード内にコンパクトに栄養素（P/F/C）の合計を統合表示しなければならない
- **FR-003**: システムは、ダッシュボードの食事サマリーカードでカロリー情報内にコンパクトに栄養素の合計を統合表示しなければならない
- **FR-004**: システムは、栄養素データがnullの食事を0として合計計算に含めなければならない
- **FR-005**: ~~システムは、食事タイプ（朝食・昼食・夕食・間食）ごとの栄養素内訳を提供しなければならない~~ **[DEFERRED - 将来の拡張]**
- **FR-006**: システムは、栄養素の値を小数点以下1桁で表示しなければならない（例: 52.3g）

### Key Entities

- **MealRecord**: 食事記録。既存のcalories, totalProtein, totalFat, totalCarbsフィールドを使用
- **NutrientSummary**: 栄養素サマリー。カロリー合計、たんぱく質合計、脂質合計、炭水化物合計を含む
- **MealTypeSummary**: 食事タイプ別サマリー。各食事タイプごとの栄養素集計

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ユーザーは食事一覧ページで今日の栄養素合計を3秒以内に確認できる
- **SC-002**: 栄養素データを持つすべての食事記録が正確に合計される（計算誤差なし）
- **SC-003**: ダッシュボードで栄養素サマリーがカロリーと同様のレイアウトで表示される
- **SC-004**: 栄養素データがない場合でも、エラーなく0として表示される

## Clarifications

### Session 2026-01-04

- Q: 食事一覧ページの日次サマリーで栄養素をどのように表示するか？ → A: カロリーカード内にコンパクトに栄養素情報を統合
- Q: ダッシュボードの食事サマリーカードでも同様にコンパクト統合するか？ → A: はい、食事一覧ページと同様にコンパクト統合
- Q: P3（食事タイプ別栄養素内訳）は初期リリースに含めるか？ → A: 将来の拡張に延期（P1/P2のみ初期リリース）

## Assumptions

- 既存のデータベーススキーマ（totalProtein, totalFat, totalCarbsフィールド）は変更不要
- AI分析で取得済みの栄養素データを使用する
- 1日あたりの目標栄養素量の設定機能は本機能のスコープ外
- 週間/月間の栄養素トレンド表示は本機能のスコープ外
- 食事タイプ別（朝食・昼食・夕食・間食）の栄養素内訳は将来の拡張として延期
