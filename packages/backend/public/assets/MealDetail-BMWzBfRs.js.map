{"version":3,"file":"MealDetail-BMWzBfRs.js","sources":["../../src/pages/MealDetail.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { useParams, useNavigate, Link } from 'react-router-dom';\nimport { api, getPhotoUrl, mealAnalysisApi } from '../lib/api';\nimport type { MealRecord, FoodItem, ChatMessage } from '@lifestyle-app/shared';\nimport { MEAL_TYPE_LABELS } from '@lifestyle-app/shared';\n\ninterface MealDetailResponse {\n  meal: MealRecord;\n}\n\nexport default function MealDetailPage() {\n  const { mealId } = useParams<{ mealId: string }>();\n  const navigate = useNavigate();\n  const [meal, setMeal] = useState<MealRecord | null>(null);\n  const [foodItems, setFoodItems] = useState<FoodItem[]>([]);\n  const [chatHistory, setChatHistory] = useState<ChatMessage[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (!mealId) return;\n\n    const loadMealData = async () => {\n      setIsLoading(true);\n      setError(null);\n\n      try {\n        // Load meal record\n        const mealResponse = await api.get<MealDetailResponse>(`/api/meals/${mealId}`);\n        setMeal(mealResponse.meal);\n\n        // Load food items if this is an AI-analyzed meal\n        if (mealResponse.meal.analysisSource === 'ai') {\n          try {\n            const { foodItems: items } = await mealAnalysisApi.getFoodItems(mealId);\n            setFoodItems(items);\n          } catch {\n            // Food items might not exist for older records\n            setFoodItems([]);\n          }\n\n          // Load chat history\n          try {\n            const { messages } = await mealAnalysisApi.getChatHistory(mealId);\n            setChatHistory(messages);\n          } catch {\n            setChatHistory([]);\n          }\n        }\n      } catch (err) {\n        setError(err instanceof Error ? err.message : 'データの読み込みに失敗しました');\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    loadMealData();\n  }, [mealId]);\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"h-8 w-8 animate-spin rounded-full border-4 border-green-600 border-t-transparent\" />\n      </div>\n    );\n  }\n\n  if (error || !meal) {\n    return (\n      <div className=\"mx-auto max-w-lg p-4\">\n        <div className=\"rounded-lg bg-red-50 p-6 text-center\">\n          <p className=\"text-red-600\">{error || '食事記録が見つかりません'}</p>\n          <button\n            onClick={() => navigate('/meals')}\n            className=\"mt-4 rounded bg-red-500 px-4 py-2 text-white hover:bg-red-600\"\n          >\n            食事記録一覧に戻る\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  const photoUrl = getPhotoUrl(meal.photoKey);\n\n  return (\n    <div className=\"mx-auto max-w-lg p-4\">\n      {/* Header */}\n      <div className=\"mb-4 flex items-center justify-between\">\n        <Link to=\"/meals\" className=\"text-blue-600 hover:text-blue-800\">\n          ← 戻る\n        </Link>\n        <div className=\"flex items-center gap-2\">\n          <span className=\"rounded-full bg-gray-100 px-3 py-1 text-sm font-medium\">\n            {MEAL_TYPE_LABELS[meal.mealType]}\n          </span>\n          {meal.analysisSource && (\n            <span\n              className={`rounded-full px-2 py-0.5 text-xs ${\n                meal.analysisSource === 'ai'\n                  ? 'bg-purple-100 text-purple-700'\n                  : 'bg-gray-100 text-gray-600'\n              }`}\n            >\n              {meal.analysisSource === 'ai' ? 'AI分析' : '手動入力'}\n            </span>\n          )}\n        </div>\n      </div>\n\n      {/* Photo */}\n      {photoUrl && (\n        <div className=\"mb-4 overflow-hidden rounded-lg\">\n          <img\n            src={photoUrl}\n            alt={meal.content}\n            className=\"w-full object-cover\"\n          />\n        </div>\n      )}\n\n      {/* Meal info */}\n      <div className=\"mb-4 rounded-lg border bg-white p-4\">\n        <h1 className=\"text-lg font-semibold text-gray-900\">{meal.content}</h1>\n        <p className=\"mt-1 text-sm text-gray-500\">\n          {new Date(meal.recordedAt).toLocaleString('ja-JP', {\n            year: 'numeric',\n            month: 'long',\n            day: 'numeric',\n            hour: '2-digit',\n            minute: '2-digit',\n          })}\n        </p>\n\n        {/* Nutrition summary */}\n        <div className=\"mt-4 grid grid-cols-4 gap-2 text-center\">\n          <div className=\"rounded-lg bg-orange-50 p-2\">\n            <div className=\"text-lg font-bold text-orange-600\">\n              {meal.calories?.toLocaleString() ?? '-'}\n            </div>\n            <div className=\"text-xs text-gray-500\">kcal</div>\n          </div>\n          <div className=\"rounded-lg bg-red-50 p-2\">\n            <div className=\"text-lg font-bold text-red-600\">\n              {meal.totalProtein ?? '-'}\n            </div>\n            <div className=\"text-xs text-gray-500\">P (g)</div>\n          </div>\n          <div className=\"rounded-lg bg-yellow-50 p-2\">\n            <div className=\"text-lg font-bold text-yellow-600\">\n              {meal.totalFat ?? '-'}\n            </div>\n            <div className=\"text-xs text-gray-500\">F (g)</div>\n          </div>\n          <div className=\"rounded-lg bg-blue-50 p-2\">\n            <div className=\"text-lg font-bold text-blue-600\">\n              {meal.totalCarbs ?? '-'}\n            </div>\n            <div className=\"text-xs text-gray-500\">C (g)</div>\n          </div>\n        </div>\n      </div>\n\n      {/* Food items list */}\n      {foodItems.length > 0 && (\n        <div className=\"mb-4 rounded-lg border bg-white p-4\">\n          <h2 className=\"mb-3 font-semibold text-gray-900\">食材一覧</h2>\n          <div className=\"space-y-2\">\n            {foodItems.map((item) => (\n              <div\n                key={item.id}\n                className=\"flex items-center justify-between rounded-lg bg-gray-50 px-3 py-2\"\n              >\n                <div>\n                  <span className=\"font-medium\">{item.name}</span>\n                  <span className=\"ml-2 text-sm text-gray-500\">\n                    ({item.portion === 'small' ? '少量' : item.portion === 'large' ? '多め' : '普通'})\n                  </span>\n                </div>\n                <div className=\"text-right text-sm\">\n                  <span className=\"font-medium\">{item.calories} kcal</span>\n                  <div className=\"text-xs text-gray-400\">\n                    P:{item.protein}g F:{item.fat}g C:{item.carbs}g\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Chat history */}\n      {chatHistory.length > 0 && (\n        <div className=\"rounded-lg border bg-white p-4\">\n          <h2 className=\"mb-3 font-semibold text-gray-900\">AIとの会話履歴</h2>\n          <div className=\"space-y-3 text-sm\">\n            {chatHistory.map((msg) => (\n              <div\n                key={msg.id}\n                className={`rounded-lg p-3 ${\n                  msg.role === 'user'\n                    ? 'ml-8 bg-blue-100 text-blue-900'\n                    : 'mr-8 bg-gray-100 text-gray-800'\n                }`}\n              >\n                <div className=\"mb-1 text-xs font-medium text-gray-500\">\n                  {msg.role === 'user' ? 'あなた' : 'AI'}\n                </div>\n                <div>{msg.content}</div>\n                {msg.appliedChanges && msg.appliedChanges.length > 0 && (\n                  <div className=\"mt-2 border-t pt-2 text-xs text-gray-500\">\n                    適用された変更: {msg.appliedChanges.length}件\n                  </div>\n                )}\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["MealDetailPage","mealId","useParams","navigate","useNavigate","meal","setMeal","useState","foodItems","setFoodItems","chatHistory","setChatHistory","isLoading","setIsLoading","error","setError","useEffect","mealResponse","api","items","mealAnalysisApi","messages","err","jsx","jsxs","photoUrl","getPhotoUrl","Link","MEAL_TYPE_LABELS","item","msg"],"mappings":"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"}