import{b as N,a as v,r as a,j as e,g as f,L as w,M as S,c as C,m as p}from"./index-DN6YVJy6.js";function L(){var u;const{mealId:l}=N(),j=v(),[t,b]=a.useState(null),[n,i]=a.useState([]),[c,o]=a.useState([]),[y,x]=a.useState(!0),[m,g]=a.useState(null);if(a.useEffect(()=>{if(!l)return;(async()=>{x(!0),g(null);try{const r=await C.get(`/api/meals/${l}`);if(b(r.meal),r.meal.analysisSource==="ai"){try{const{foodItems:d}=await p.getFoodItems(l);i(d)}catch{i([])}try{const{messages:d}=await p.getChatHistory(l);o(d)}catch{o([])}}}catch(r){g(r instanceof Error?r.message:"データの読み込みに失敗しました")}finally{x(!1)}})()},[l]),y)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-green-600 border-t-transparent"})});if(m||!t)return e.jsx("div",{className:"mx-auto max-w-lg p-4",children:e.jsxs("div",{className:"rounded-lg bg-red-50 p-6 text-center",children:[e.jsx("p",{className:"text-red-600",children:m||"食事記録が見つかりません"}),e.jsx("button",{onClick:()=>j("/meals"),className:"mt-4 rounded bg-red-500 px-4 py-2 text-white hover:bg-red-600",children:"食事記録一覧に戻る"})]})});const h=f(t.photoKey);return e.jsxs("div",{className:"mx-auto max-w-lg p-4",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx(w,{to:"/meals",className:"text-blue-600 hover:text-blue-800",children:"← 戻る"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"rounded-full bg-gray-100 px-3 py-1 text-sm font-medium",children:S[t.mealType]}),t.analysisSource&&e.jsx("span",{className:`rounded-full px-2 py-0.5 text-xs ${t.analysisSource==="ai"?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-600"}`,children:t.analysisSource==="ai"?"AI分析":"手動入力"})]})]}),h&&e.jsx("div",{className:"mb-4 overflow-hidden rounded-lg",children:e.jsx("img",{src:h,alt:t.content,className:"w-full object-cover"})}),e.jsxs("div",{className:"mb-4 rounded-lg border bg-white p-4",children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:t.content}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:new Date(t.recordedAt).toLocaleString("ja-JP",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}),e.jsxs("div",{className:"mt-4 grid grid-cols-4 gap-2 text-center",children:[e.jsxs("div",{className:"rounded-lg bg-orange-50 p-2",children:[e.jsx("div",{className:"text-lg font-bold text-orange-600",children:((u=t.calories)==null?void 0:u.toLocaleString())??"-"}),e.jsx("div",{className:"text-xs text-gray-500",children:"kcal"})]}),e.jsxs("div",{className:"rounded-lg bg-red-50 p-2",children:[e.jsx("div",{className:"text-lg font-bold text-red-600",children:t.totalProtein??"-"}),e.jsx("div",{className:"text-xs text-gray-500",children:"P (g)"})]}),e.jsxs("div",{className:"rounded-lg bg-yellow-50 p-2",children:[e.jsx("div",{className:"text-lg font-bold text-yellow-600",children:t.totalFat??"-"}),e.jsx("div",{className:"text-xs text-gray-500",children:"F (g)"})]}),e.jsxs("div",{className:"rounded-lg bg-blue-50 p-2",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:t.totalCarbs??"-"}),e.jsx("div",{className:"text-xs text-gray-500",children:"C (g)"})]})]})]}),n.length>0&&e.jsxs("div",{className:"mb-4 rounded-lg border bg-white p-4",children:[e.jsx("h2",{className:"mb-3 font-semibold text-gray-900",children:"食材一覧"}),e.jsx("div",{className:"space-y-2",children:n.map(s=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg bg-gray-50 px-3 py-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["(",s.portion==="small"?"少量":s.portion==="large"?"多め":"普通",")"]})]}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("span",{className:"font-medium",children:[s.calories," kcal"]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["P:",s.protein,"g F:",s.fat,"g C:",s.carbs,"g"]})]})]},s.id))})]}),c.length>0&&e.jsxs("div",{className:"rounded-lg border bg-white p-4",children:[e.jsx("h2",{className:"mb-3 font-semibold text-gray-900",children:"AIとの会話履歴"}),e.jsx("div",{className:"space-y-3 text-sm",children:c.map(s=>e.jsxs("div",{className:`rounded-lg p-3 ${s.role==="user"?"ml-8 bg-blue-100 text-blue-900":"mr-8 bg-gray-100 text-gray-800"}`,children:[e.jsx("div",{className:"mb-1 text-xs font-medium text-gray-500",children:s.role==="user"?"あなた":"AI"}),e.jsx("div",{children:s.content}),s.appliedChanges&&s.appliedChanges.length>0&&e.jsxs("div",{className:"mt-2 border-t pt-2 text-xs text-gray-500",children:["適用された変更: ",s.appliedChanges.length,"件"]})]},s.id))})]})]})}export{L as default};
//# sourceMappingURL=MealDetail-BMWzBfRs.js.map
