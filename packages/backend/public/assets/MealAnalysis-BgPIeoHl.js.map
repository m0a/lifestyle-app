{"version":3,"file":"MealAnalysis-BgPIeoHl.js","sources":["../../src/components/meal/PhotoCapture.tsx","../../src/components/meal/AnalysisResult.tsx","../../src/components/meal/MealChat.tsx","../../src/pages/MealAnalysis.tsx"],"sourcesContent":["import { useRef, useState, useCallback } from 'react';\nimport { logError } from '../../lib/errorLogger';\n\ninterface PhotoCaptureProps {\n  onCapture: (photo: Blob) => void;\n  onCancel?: () => void;\n  maxSize?: number; // Max dimension in pixels, default 1024\n}\n\nexport function PhotoCapture({ onCapture, onCancel, maxSize = 1024 }: PhotoCaptureProps) {\n  const [mode, setMode] = useState<'select' | 'camera'>('select');\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [isVideoReady, setIsVideoReady] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const streamRef = useRef<MediaStream | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  // Resize image using Canvas API with memory management\n  const resizeImage = useCallback(async (file: Blob, maxDimension: number): Promise<Blob> => {\n    return new Promise((resolve, reject) => {\n      const objectUrl = URL.createObjectURL(file);\n      const img = new Image();\n\n      const cleanup = () => {\n        URL.revokeObjectURL(objectUrl);\n      };\n\n      img.onload = () => {\n        try {\n          const scale = Math.min(1, maxDimension / Math.max(img.width, img.height));\n          const width = Math.round(img.width * scale);\n          const height = Math.round(img.height * scale);\n\n          // Use OffscreenCanvas if available for better performance on mobile\n          let canvas: HTMLCanvasElement | OffscreenCanvas;\n          let ctx: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D | null;\n\n          if (typeof OffscreenCanvas !== 'undefined') {\n            canvas = new OffscreenCanvas(width, height);\n            ctx = canvas.getContext('2d');\n          } else {\n            canvas = document.createElement('canvas');\n            canvas.width = width;\n            canvas.height = height;\n            ctx = canvas.getContext('2d');\n          }\n\n          if (!ctx) {\n            cleanup();\n            reject(new Error('Canvas context not available'));\n            return;\n          }\n\n          ctx.drawImage(img, 0, 0, width, height);\n\n          // Convert to blob\n          if (canvas instanceof OffscreenCanvas) {\n            canvas.convertToBlob({ type: 'image/jpeg', quality: 0.8 })\n              .then((blob) => {\n                cleanup();\n                resolve(blob);\n              })\n              .catch((err) => {\n                cleanup();\n                reject(err);\n              });\n          } else {\n            canvas.toBlob(\n              (blob) => {\n                cleanup();\n                if (blob) {\n                  resolve(blob);\n                } else {\n                  reject(new Error('Failed to create blob'));\n                }\n              },\n              'image/jpeg',\n              0.8\n            );\n          }\n        } catch (err) {\n          cleanup();\n          reject(err);\n        }\n      };\n\n      img.onerror = () => {\n        cleanup();\n        reject(new Error('Failed to load image'));\n      };\n\n      img.src = objectUrl;\n    });\n  }, []);\n\n  // Handle file selection\n  const handleFileSelect = useCallback(\n    async (event: React.ChangeEvent<HTMLInputElement>) => {\n      const file = event.target.files?.[0];\n      if (!file) return;\n\n      if (!file.type.startsWith('image/')) {\n        setError('ÁîªÂÉè„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');\n        return;\n      }\n\n      setIsProcessing(true);\n      setError(null);\n\n      try {\n        const resized = await resizeImage(file, maxSize);\n        onCapture(resized);\n      } catch (err) {\n        setError('ÁîªÂÉè„ÅÆÂá¶ÁêÜ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');\n        const error = err instanceof Error ? err : new Error(String(err));\n        logError(error, { component: 'PhotoCapture', action: 'handleFileSelect' });\n      } finally {\n        setIsProcessing(false);\n      }\n    },\n    [maxSize, onCapture, resizeImage]\n  );\n\n  // Start camera\n  const startCamera = useCallback(async () => {\n    setError(null);\n    setIsVideoReady(false);\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: { facingMode: 'environment' },\n      });\n      streamRef.current = stream;\n      if (videoRef.current) {\n        const video = videoRef.current;\n\n        // Multiple event handlers for better mobile compatibility\n        const markReady = () => {\n          if (video.videoWidth > 0 && video.videoHeight > 0) {\n            setIsVideoReady(true);\n            cleanup();\n          }\n        };\n\n        const cleanup = () => {\n          video.removeEventListener('playing', markReady);\n          video.removeEventListener('loadeddata', markReady);\n          video.removeEventListener('canplay', markReady);\n        };\n\n        // Try multiple events - different browsers fire different events\n        video.addEventListener('playing', markReady);\n        video.addEventListener('loadeddata', markReady);\n        video.addEventListener('canplay', markReady);\n\n        video.srcObject = stream;\n\n        // Call play() and handle the promise\n        video.play().catch((playErr) => {\n          console.warn('Video autoplay failed:', playErr);\n        });\n\n        // Fallback: check periodically if video is ready\n        let attempts = 0;\n        const checkReady = setInterval(() => {\n          attempts++;\n          if (video.videoWidth > 0 && video.videoHeight > 0) {\n            setIsVideoReady(true);\n            clearInterval(checkReady);\n            cleanup();\n          } else if (attempts > 50) {\n            // 5 seconds timeout\n            clearInterval(checkReady);\n            cleanup();\n            setError('„Ç´„É°„É©„ÅÆÂàùÊúüÂåñ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');\n            logError(new Error('Video ready timeout'), {\n              component: 'PhotoCapture',\n              action: 'startCamera',\n              videoWidth: video.videoWidth,\n              videoHeight: video.videoHeight,\n              readyState: video.readyState,\n            });\n          }\n        }, 100);\n      }\n      setMode('camera');\n    } catch (err) {\n      setError('„Ç´„É°„É©„Å´„Ç¢„ÇØ„Çª„Çπ„Åß„Åç„Åæ„Åõ„Çì');\n      const error = err instanceof Error ? err : new Error(String(err));\n      logError(error, { component: 'PhotoCapture', action: 'startCamera' });\n    }\n  }, []);\n\n  // Stop camera\n  const stopCamera = useCallback(() => {\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach((track) => track.stop());\n      streamRef.current = null;\n    }\n    setIsVideoReady(false);\n    setMode('select');\n  }, []);\n\n  // Capture photo from camera\n  const captureFromCamera = useCallback(async () => {\n    if (!videoRef.current) return;\n\n    setIsProcessing(true);\n    setError(null);\n\n    try {\n      const video = videoRef.current;\n\n      // Wait for video to be ready if dimensions are not available\n      if (video.videoWidth === 0 || video.videoHeight === 0) {\n        await new Promise<void>((resolve, reject) => {\n          const timeout = setTimeout(() => reject(new Error('Video not ready')), 5000);\n          video.onloadedmetadata = () => {\n            clearTimeout(timeout);\n            resolve();\n          };\n        });\n      }\n\n      // Double check dimensions\n      if (video.videoWidth === 0 || video.videoHeight === 0) {\n        throw new Error('Video dimensions not available');\n      }\n\n      const canvas = document.createElement('canvas');\n      canvas.width = video.videoWidth;\n      canvas.height = video.videoHeight;\n\n      const ctx = canvas.getContext('2d');\n      if (!ctx) {\n        throw new Error('Canvas context not available');\n      }\n\n      ctx.drawImage(video, 0, 0);\n\n      const blob = await new Promise<Blob>((resolve, reject) => {\n        canvas.toBlob(\n          (b) => (b ? resolve(b) : reject(new Error('Failed to create blob'))),\n          'image/jpeg',\n          0.9\n        );\n      });\n\n      const resized = await resizeImage(blob, maxSize);\n      stopCamera();\n      onCapture(resized);\n    } catch (err) {\n      setError('ÊíÆÂΩ±„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');\n      const error = err instanceof Error ? err : new Error(String(err));\n      logError(error, { component: 'PhotoCapture', action: 'captureFromCamera' });\n    } finally {\n      setIsProcessing(false);\n    }\n  }, [maxSize, onCapture, resizeImage, stopCamera]);\n\n  if (mode === 'camera') {\n    return (\n      <div className=\"flex flex-col items-center gap-4\">\n        <video\n          ref={videoRef}\n          autoPlay\n          playsInline\n          muted\n          className=\"w-full max-w-md rounded-lg border\"\n        />\n        <div className=\"flex gap-4\">\n          <button\n            onClick={captureFromCamera}\n            disabled={isProcessing || !isVideoReady}\n            className=\"rounded-full bg-blue-500 p-4 text-white hover:bg-blue-600 disabled:opacity-50\"\n          >\n            {isProcessing ? 'Âá¶ÁêÜ‰∏≠...' : isVideoReady ? 'ÊíÆÂΩ±' : 'Ê∫ñÂÇô‰∏≠...'}\n          </button>\n          <button\n            onClick={stopCamera}\n            className=\"rounded-lg border px-4 py-2 hover:bg-gray-100\"\n          >\n            „Ç≠„É£„É≥„Çª„É´\n          </button>\n        </div>\n        {error && <p className=\"text-sm text-red-500\">{error}</p>}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col items-center gap-4 p-4\">\n      <h3 className=\"text-lg font-semibold\">È£ü‰∫ã„ÅÆÂÜôÁúü„ÇíËøΩÂä†</h3>\n\n      <input\n        ref={fileInputRef}\n        type=\"file\"\n        accept=\"image/*\"\n        onChange={handleFileSelect}\n        className=\"hidden\"\n      />\n\n      <div className=\"flex gap-4\">\n        <button\n          onClick={() => fileInputRef.current?.click()}\n          disabled={isProcessing}\n          className=\"flex items-center gap-2 rounded-lg border px-4 py-3 hover:bg-gray-100 disabled:opacity-50\"\n        >\n          <span>üìÅ</span>\n          <span>„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû</span>\n        </button>\n\n        <button\n          onClick={startCamera}\n          disabled={isProcessing}\n          className=\"flex items-center gap-2 rounded-lg border px-4 py-3 hover:bg-gray-100 disabled:opacity-50\"\n        >\n          <span>üì∑</span>\n          <span>„Ç´„É°„É©„ÅßÊíÆÂΩ±</span>\n        </button>\n      </div>\n\n      {isProcessing && <p className=\"text-sm text-gray-500\">ÁîªÂÉè„ÇíÂá¶ÁêÜ‰∏≠...</p>}\n      {error && <p className=\"text-sm text-red-500\">{error}</p>}\n\n      {onCancel && (\n        <button\n          onClick={onCancel}\n          className=\"text-sm text-gray-500 hover:text-gray-700\"\n        >\n          „Ç≠„É£„É≥„Çª„É´\n        </button>\n      )}\n    </div>\n  );\n}\n","import { useState } from 'react';\nimport type { FoodItem, NutritionTotals, Portion } from '@lifestyle-app/shared';\n\ninterface AnalysisResultProps {\n  photoUrl?: string;\n  foodItems: FoodItem[];\n  totals: NutritionTotals;\n  isLoading?: boolean;\n  onUpdateItem?: (itemId: string, updates: Partial<FoodItem>) => Promise<void>;\n  onDeleteItem?: (itemId: string) => Promise<void>;\n  onAddItem?: (item: Omit<FoodItem, 'id'>) => Promise<void>;\n}\n\nexport function AnalysisResult({\n  photoUrl,\n  foodItems,\n  totals,\n  isLoading,\n  onUpdateItem,\n  onDeleteItem,\n  onAddItem,\n}: AnalysisResultProps) {\n  const [editingId, setEditingId] = useState<string | null>(null);\n  const [showAddForm, setShowAddForm] = useState(false);\n\n  if (isLoading) {\n    return (\n      <div className=\"flex flex-col items-center gap-4 p-8\">\n        <div className=\"h-12 w-12 animate-spin rounded-full border-4 border-blue-500 border-t-transparent\" />\n        <p className=\"text-gray-600\">AI „ÅåÈ£ü‰∫ã„ÇíÂàÜÊûê‰∏≠...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col gap-4\">\n      {/* Photo thumbnail */}\n      {photoUrl && (\n        <div className=\"flex justify-center\">\n          <img\n            src={photoUrl}\n            alt=\"È£ü‰∫ã„ÅÆÂÜôÁúü\"\n            className=\"max-h-48 rounded-lg object-cover\"\n          />\n        </div>\n      )}\n\n      {/* Totals summary */}\n      <div className=\"rounded-lg bg-blue-50 p-4\">\n        <h3 className=\"mb-2 font-semibold\">ÂêàË®à</h3>\n        <div className=\"grid grid-cols-4 gap-2 text-center text-sm\">\n          <div>\n            <div className=\"text-lg font-bold text-blue-600\">{totals.calories}</div>\n            <div className=\"text-gray-500\">kcal</div>\n          </div>\n          <div>\n            <div className=\"text-lg font-bold text-green-600\">{totals.protein.toFixed(1)}</div>\n            <div className=\"text-gray-500\">P (g)</div>\n          </div>\n          <div>\n            <div className=\"text-lg font-bold text-yellow-600\">{totals.fat.toFixed(1)}</div>\n            <div className=\"text-gray-500\">F (g)</div>\n          </div>\n          <div>\n            <div className=\"text-lg font-bold text-orange-600\">{totals.carbs.toFixed(1)}</div>\n            <div className=\"text-gray-500\">C (g)</div>\n          </div>\n        </div>\n      </div>\n\n      {/* Food items list */}\n      <div className=\"space-y-2\">\n        <h3 className=\"font-semibold\">Ë≠òÂà•„Åï„Çå„ÅüÈ£üÊùê</h3>\n        {foodItems.map((item) =>\n          editingId === item.id ? (\n            <FoodItemEditForm\n              key={item.id}\n              item={item}\n              onSave={async (updates) => {\n                await onUpdateItem?.(item.id, updates);\n                setEditingId(null);\n              }}\n              onCancel={() => setEditingId(null)}\n            />\n          ) : (\n            <FoodItemCard\n              key={item.id}\n              item={item}\n              onEdit={() => setEditingId(item.id)}\n              onDelete={() => onDeleteItem?.(item.id)}\n              editable={!!onUpdateItem}\n            />\n          )\n        )}\n      </div>\n\n      {/* Add food button */}\n      {onAddItem && (\n        <div>\n          {showAddForm ? (\n            <FoodItemEditForm\n              onSave={async (item) => {\n                await onAddItem(item as Omit<FoodItem, 'id'>);\n                setShowAddForm(false);\n              }}\n              onCancel={() => setShowAddForm(false)}\n            />\n          ) : (\n            <button\n              onClick={() => setShowAddForm(true)}\n              className=\"w-full rounded-lg border-2 border-dashed border-gray-300 py-3 text-gray-500 hover:border-gray-400 hover:text-gray-600\"\n            >\n              + È£üÊùê„ÇíËøΩÂä†\n            </button>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\ninterface FoodItemCardProps {\n  item: FoodItem;\n  onEdit?: () => void;\n  onDelete?: () => void;\n  editable?: boolean;\n}\n\nfunction FoodItemCard({ item, onEdit, onDelete, editable }: FoodItemCardProps) {\n  const portionLabel = {\n    small: 'Â∞è',\n    medium: '‰∏≠',\n    large: 'Â§ß',\n  }[item.portion];\n\n  return (\n    <div className=\"flex items-center justify-between rounded-lg border p-3\">\n      <div className=\"flex-1\">\n        <div className=\"flex items-center gap-2\">\n          <span className=\"font-medium\">{item.name}</span>\n          <span className=\"rounded bg-gray-100 px-2 py-0.5 text-xs text-gray-600\">\n            {portionLabel}\n          </span>\n        </div>\n        <div className=\"mt-1 text-sm text-gray-500\">\n          {item.calories}kcal | P{item.protein}g F{item.fat}g C{item.carbs}g\n        </div>\n      </div>\n      {editable && (\n        <div className=\"flex gap-2\">\n          <button\n            onClick={onEdit}\n            className=\"rounded p-1 text-gray-400 hover:bg-gray-100 hover:text-gray-600\"\n          >\n            ‚úèÔ∏è\n          </button>\n          <button\n            onClick={onDelete}\n            className=\"rounded p-1 text-gray-400 hover:bg-gray-100 hover:text-red-500\"\n          >\n            üóëÔ∏è\n          </button>\n        </div>\n      )}\n    </div>\n  );\n}\n\ninterface FoodItemEditFormProps {\n  item?: FoodItem;\n  onSave: (item: Partial<FoodItem>) => Promise<void>;\n  onCancel: () => void;\n}\n\nfunction FoodItemEditForm({ item, onSave, onCancel }: FoodItemEditFormProps) {\n  const [name, setName] = useState(item?.name || '');\n  const [portion, setPortion] = useState<Portion>(item?.portion || 'medium');\n  const [calories, setCalories] = useState(item?.calories?.toString() || '');\n  const [protein, setProtein] = useState(item?.protein?.toString() || '');\n  const [fat, setFat] = useState(item?.fat?.toString() || '');\n  const [carbs, setCarbs] = useState(item?.carbs?.toString() || '');\n  const [isSaving, setIsSaving] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsSaving(true);\n    try {\n      await onSave({\n        name,\n        portion,\n        calories: parseInt(calories) || 0,\n        protein: parseFloat(protein) || 0,\n        fat: parseFloat(fat) || 0,\n        carbs: parseFloat(carbs) || 0,\n      });\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-3 rounded-lg border p-3\">\n      <div>\n        <input\n          type=\"text\"\n          value={name}\n          onChange={(e) => setName(e.target.value)}\n          placeholder=\"È£üÊùêÂêç\"\n          required\n          className=\"w-full rounded border px-3 py-2\"\n        />\n      </div>\n      <div className=\"flex gap-2\">\n        <select\n          value={portion}\n          onChange={(e) => setPortion(e.target.value as Portion)}\n          className=\"rounded border px-3 py-2\"\n        >\n          <option value=\"small\">Â∞è</option>\n          <option value=\"medium\">‰∏≠</option>\n          <option value=\"large\">Â§ß</option>\n        </select>\n        <input\n          type=\"number\"\n          value={calories}\n          onChange={(e) => setCalories(e.target.value)}\n          placeholder=\"kcal\"\n          required\n          className=\"w-20 rounded border px-3 py-2\"\n        />\n      </div>\n      <div className=\"flex gap-2\">\n        <input\n          type=\"number\"\n          step=\"0.1\"\n          value={protein}\n          onChange={(e) => setProtein(e.target.value)}\n          placeholder=\"P (g)\"\n          className=\"w-20 rounded border px-3 py-2\"\n        />\n        <input\n          type=\"number\"\n          step=\"0.1\"\n          value={fat}\n          onChange={(e) => setFat(e.target.value)}\n          placeholder=\"F (g)\"\n          className=\"w-20 rounded border px-3 py-2\"\n        />\n        <input\n          type=\"number\"\n          step=\"0.1\"\n          value={carbs}\n          onChange={(e) => setCarbs(e.target.value)}\n          placeholder=\"C (g)\"\n          className=\"w-20 rounded border px-3 py-2\"\n        />\n      </div>\n      <div className=\"flex justify-end gap-2\">\n        <button\n          type=\"button\"\n          onClick={onCancel}\n          className=\"rounded px-3 py-1 text-gray-500 hover:bg-gray-100\"\n        >\n          „Ç≠„É£„É≥„Çª„É´\n        </button>\n        <button\n          type=\"submit\"\n          disabled={isSaving}\n          className=\"rounded bg-blue-500 px-3 py-1 text-white hover:bg-blue-600 disabled:opacity-50\"\n        >\n          {isSaving ? '‰øùÂ≠ò‰∏≠...' : '‰øùÂ≠ò'}\n        </button>\n      </div>\n    </form>\n  );\n}\n","import { useState, useCallback, useRef, useEffect } from 'react';\nimport { mealAnalysisApi } from '../../lib/api';\nimport { useToast } from '../ui/Toast';\nimport type { FoodItem, NutritionTotals, FoodItemChange, ChatMessage } from '@lifestyle-app/shared';\n\ninterface MealChatProps {\n  mealId: string;\n  currentFoodItems: FoodItem[];\n  onUpdate: (foodItems: FoodItem[], totals: NutritionTotals) => void;\n}\n\ninterface DisplayMessage {\n  id: string;\n  role: 'user' | 'assistant';\n  content: string;\n  changes?: FoodItemChange[];\n  isStreaming?: boolean;\n}\n\nexport function MealChat({ mealId, currentFoodItems: _currentFoodItems, onUpdate }: MealChatProps) {\n  const toast = useToast();\n  const [messages, setMessages] = useState<DisplayMessage[]>([]);\n  const [input, setInput] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [pendingChanges, setPendingChanges] = useState<FoodItemChange[]>([]);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  // Load chat history on mount\n  useEffect(() => {\n    const loadHistory = async () => {\n      try {\n        const { messages: history } = await mealAnalysisApi.getChatHistory(mealId);\n        setMessages(\n          history.map((msg: ChatMessage) => ({\n            id: msg.id,\n            role: msg.role,\n            content: msg.content,\n            changes: msg.appliedChanges,\n          }))\n        );\n      } catch (error) {\n        console.error('Failed to load chat history:', error);\n        // Show error but don't block chat functionality\n        if (error instanceof TypeError && (error as TypeError).message === 'Failed to fetch') {\n          toast.warning('„ÉÅ„É£„ÉÉ„ÉàÂ±•Ê≠¥„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');\n        }\n      }\n    };\n    loadHistory();\n  }, [mealId, toast]);\n\n  // Auto-scroll to bottom\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages]);\n\n  const handleSend = useCallback(async () => {\n    if (!input.trim() || isLoading) return;\n\n    const userMessage = input.trim();\n    setInput('');\n    setIsLoading(true);\n\n    // Add user message\n    const userMsgId = `user-${Date.now()}`;\n    setMessages((prev) => [...prev, { id: userMsgId, role: 'user', content: userMessage }]);\n\n    // Add streaming assistant message\n    const assistantMsgId = `assistant-${Date.now()}`;\n    setMessages((prev) => [\n      ...prev,\n      { id: assistantMsgId, role: 'assistant', content: '', isStreaming: true },\n    ]);\n\n    try {\n      let fullContent = '';\n      let changes: FoodItemChange[] = [];\n\n      for await (const event of mealAnalysisApi.sendChatMessage(mealId, userMessage)) {\n        if (event.text) {\n          fullContent += event.text;\n          setMessages((prev) =>\n            prev.map((msg) =>\n              msg.id === assistantMsgId ? { ...msg, content: fullContent } : msg\n            )\n          );\n        }\n\n        if (event.done) {\n          changes = event.changes || [];\n          setMessages((prev) =>\n            prev.map((msg) =>\n              msg.id === assistantMsgId\n                ? { ...msg, id: event.messageId || assistantMsgId, isStreaming: false, changes }\n                : msg\n            )\n          );\n          if (changes.length > 0) {\n            setPendingChanges(changes);\n          }\n        }\n\n        if (event.error) {\n          setMessages((prev) =>\n            prev.map((msg) =>\n              msg.id === assistantMsgId\n                ? { ...msg, content: event.error || '„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü', isStreaming: false }\n                : msg\n            )\n          );\n        }\n      }\n    } catch (error) {\n      console.error('Chat error:', error);\n      setMessages((prev) =>\n        prev.map((msg) =>\n          msg.id === assistantMsgId\n            ? { ...msg, content: '„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü', isStreaming: false }\n            : msg\n        )\n      );\n    } finally {\n      setIsLoading(false);\n    }\n  }, [input, isLoading, mealId]);\n\n  const handleApplyChanges = useCallback(async () => {\n    if (pendingChanges.length === 0) return;\n\n    try {\n      const result = await mealAnalysisApi.applyChatSuggestion(mealId, pendingChanges);\n      onUpdate(result.foodItems, result.updatedTotals);\n      setPendingChanges([]);\n      toast.success('Â§âÊõ¥„ÇíÈÅ©Áî®„Åó„Åæ„Åó„Åü');\n    } catch (error) {\n      console.error('Apply changes error:', error);\n      if (error instanceof TypeError && (error as TypeError).message === 'Failed to fetch') {\n        toast.error('„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Å´Êé•Á∂ö„Åß„Åç„Åæ„Åõ„Çì');\n      } else {\n        toast.error('Â§âÊõ¥„ÅÆÈÅ©Áî®„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');\n      }\n    }\n  }, [mealId, pendingChanges, onUpdate, toast]);\n\n  const handleKeyPress = useCallback(\n    (e: React.KeyboardEvent) => {\n      if (e.key === 'Enter' && !e.shiftKey) {\n        e.preventDefault();\n        handleSend();\n      }\n    },\n    [handleSend]\n  );\n\n  return (\n    <div className=\"rounded-lg border\">\n      {/* Messages */}\n      <div className=\"h-64 overflow-y-auto p-4\">\n        {messages.length === 0 && (\n          <div className=\"text-center text-gray-400\">\n            <p>AI„Ç¢„Ç∑„Çπ„Çø„É≥„Éà„Å´Ë≥™Âïè„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>\n            <p className=\"mt-2 text-sm\">‰æã: „ÅîÈ£Ø„ÇíÂçäÂàÜ„Å´„Åó„Åü„ÅÑ„ÄÅ„Çø„É≥„Éë„ÇØË≥™„ÇíÂ¢ó„ÇÑ„Åô„Å´„ÅØÔºü</p>\n          </div>\n        )}\n        {messages.map((msg) => (\n          <div\n            key={msg.id}\n            className={`mb-3 ${msg.role === 'user' ? 'text-right' : 'text-left'}`}\n          >\n            <div\n              className={`inline-block max-w-[80%] rounded-lg px-4 py-2 ${\n                msg.role === 'user'\n                  ? 'bg-blue-500 text-white'\n                  : 'bg-gray-100 text-gray-800'\n              }`}\n            >\n              {msg.content}\n              {msg.isStreaming && <span className=\"ml-1 animate-pulse\">...</span>}\n            </div>\n          </div>\n        ))}\n        <div ref={messagesEndRef} />\n      </div>\n\n      {/* Pending changes */}\n      {pendingChanges.length > 0 && (\n        <div className=\"border-t bg-yellow-50 p-3\">\n          <p className=\"mb-2 text-sm font-medium\">AI„Åã„Çâ„ÅÆÂ§âÊõ¥ÊèêÊ°à:</p>\n          <ul className=\"mb-2 text-sm text-gray-600\">\n            {pendingChanges.map((change, i) => (\n              <li key={i}>\n                {change.action === 'add' && `ËøΩÂä†: ${change.foodItem?.name}`}\n                {change.action === 'remove' && 'ÂâäÈô§: (È£üÊùê)'}\n                {change.action === 'update' && 'Â§âÊõ¥: (È£üÊùê)'}\n              </li>\n            ))}\n          </ul>\n          <div className=\"flex gap-2\">\n            <button\n              onClick={handleApplyChanges}\n              className=\"rounded bg-green-500 px-4 py-1 text-sm text-white hover:bg-green-600\"\n            >\n              ÈÅ©Áî®„Åô„Çã\n            </button>\n            <button\n              onClick={() => setPendingChanges([])}\n              className=\"rounded px-4 py-1 text-sm text-gray-500 hover:bg-gray-200\"\n            >\n              „Ç≠„É£„É≥„Çª„É´\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Input */}\n      <div className=\"flex border-t p-3\">\n        <input\n          type=\"text\"\n          value={input}\n          onChange={(e) => setInput(e.target.value)}\n          onKeyPress={handleKeyPress}\n          placeholder=\"„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂÖ•Âäõ...\"\n          disabled={isLoading}\n          className=\"flex-1 rounded-l-lg border-y border-l px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n        />\n        <button\n          onClick={handleSend}\n          disabled={isLoading || !input.trim()}\n          className=\"rounded-r-lg bg-blue-500 px-4 py-2 text-white hover:bg-blue-600 disabled:opacity-50\"\n        >\n          ÈÄÅ‰ø°\n        </button>\n      </div>\n    </div>\n  );\n}\n","import { useState, useCallback } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { PhotoCapture } from '../components/meal/PhotoCapture';\nimport { AnalysisResult } from '../components/meal/AnalysisResult';\nimport { MealChat } from '../components/meal/MealChat';\nimport { useToast } from '../components/ui/Toast';\nimport { mealAnalysisApi, type MealAnalysisResponse } from '../lib/api';\nimport type { FoodItem, NutritionTotals, MealType, AnalysisFailure } from '@lifestyle-app/shared';\n\n// Helper to get user-friendly error message\nfunction getErrorMessage(error: unknown): string {\n  if (error instanceof TypeError && error.message === 'Failed to fetch') {\n    return '„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Å´Êé•Á∂ö„Åß„Åç„Åæ„Åõ„Çì„ÄÇ„Ç§„É≥„Çø„Éº„Éç„ÉÉ„ÉàÊé•Á∂ö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';\n  }\n  if (error instanceof Error) {\n    return error.message;\n  }\n  return '‰∫àÊúü„Åó„Å™„ÅÑ„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü';\n}\n\ntype AnalysisState =\n  | { phase: 'capture' }\n  | { phase: 'analyzing' }\n  | { phase: 'creating' } // Creating empty meal for manual input\n  | { phase: 'result'; mealId: string; photoUrl?: string; foodItems: FoodItem[]; totals: NutritionTotals }\n  | { phase: 'error'; message: string };\n\nexport default function MealAnalysisPage() {\n  const navigate = useNavigate();\n  const toast = useToast();\n  const [state, setState] = useState<AnalysisState>({ phase: 'capture' });\n  const [showChat, setShowChat] = useState(false);\n  const [selectedMealType, setSelectedMealType] = useState<MealType>('lunch');\n  const [isSaving, setIsSaving] = useState(false);\n\n  const handlePhotoCapture = useCallback(async (photo: Blob) => {\n    setState({ phase: 'analyzing' });\n\n    try {\n      const result = await mealAnalysisApi.analyzeMealPhoto(photo);\n\n      if ('error' in result) {\n        const failure = result as AnalysisFailure;\n        setState({ phase: 'error', message: failure.message });\n        return;\n      }\n\n      const analysisResult = result as MealAnalysisResponse;\n      setState({\n        phase: 'result',\n        mealId: analysisResult.mealId,\n        photoUrl: `/api/meals/photos/${encodeURIComponent(analysisResult.photoKey)}`,\n        foodItems: analysisResult.foodItems,\n        totals: analysisResult.totals,\n      });\n    } catch (error) {\n      console.error('Analysis error:', error);\n      setState({\n        phase: 'error',\n        message: error instanceof Error ? error.message : 'ÂàÜÊûê‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü',\n      });\n    }\n  }, []);\n\n  const handleManualEntry = useCallback(async () => {\n    setState({ phase: 'creating' });\n\n    try {\n      const result = await mealAnalysisApi.createEmptyMeal();\n      setState({\n        phase: 'result',\n        mealId: result.mealId,\n        photoUrl: undefined,\n        foodItems: [],\n        totals: { calories: 0, protein: 0, fat: 0, carbs: 0 },\n      });\n    } catch (error) {\n      console.error('Create empty meal error:', error);\n      setState({\n        phase: 'error',\n        message: getErrorMessage(error),\n      });\n    }\n  }, []);\n\n  const handleUpdateItem = useCallback(\n    async (itemId: string, updates: Partial<FoodItem>) => {\n      if (state.phase !== 'result') return;\n\n      try {\n        const result = await mealAnalysisApi.updateFoodItem(state.mealId, itemId, updates);\n        setState({\n          ...state,\n          foodItems: state.foodItems.map((item) =>\n            item.id === itemId ? result.foodItem : item\n          ),\n          totals: result.updatedTotals,\n        });\n      } catch (error) {\n        console.error('Update item error:', error);\n        toast.error(getErrorMessage(error));\n      }\n    },\n    [state, toast]\n  );\n\n  const handleDeleteItem = useCallback(\n    async (itemId: string) => {\n      if (state.phase !== 'result') return;\n\n      try {\n        const result = await mealAnalysisApi.deleteFoodItem(state.mealId, itemId);\n        setState({\n          ...state,\n          foodItems: state.foodItems.filter((item) => item.id !== itemId),\n          totals: result.updatedTotals,\n        });\n      } catch (error) {\n        console.error('Delete item error:', error);\n        toast.error(getErrorMessage(error));\n      }\n    },\n    [state, toast]\n  );\n\n  const handleAddItem = useCallback(\n    async (item: Omit<FoodItem, 'id'>) => {\n      if (state.phase !== 'result') return;\n\n      try {\n        const result = await mealAnalysisApi.addFoodItem(state.mealId, item);\n        setState({\n          ...state,\n          foodItems: [...state.foodItems, result.foodItem],\n          totals: result.updatedTotals,\n        });\n      } catch (error) {\n        console.error('Add item error:', error);\n        toast.error(getErrorMessage(error));\n      }\n    },\n    [state, toast]\n  );\n\n  const handleChatUpdate = useCallback(\n    (foodItems: FoodItem[], totals: NutritionTotals) => {\n      if (state.phase !== 'result') return;\n      setState({ ...state, foodItems, totals });\n    },\n    [state]\n  );\n\n  const handleSave = useCallback(async () => {\n    if (state.phase !== 'result') return;\n\n    setIsSaving(true);\n    try {\n      await mealAnalysisApi.saveMealAnalysis(state.mealId, selectedMealType);\n      toast.success('È£ü‰∫ã„ÇíË®òÈå≤„Åó„Åæ„Åó„Åü');\n      navigate('/meals');\n    } catch (error) {\n      console.error('Save error:', error);\n      toast.error(getErrorMessage(error));\n    } finally {\n      setIsSaving(false);\n    }\n  }, [state, selectedMealType, navigate, toast]);\n\n  const handleReset = useCallback(() => {\n    setState({ phase: 'capture' });\n    setShowChat(false);\n  }, []);\n\n  return (\n    <div className=\"mx-auto max-w-lg p-4\">\n      <div className=\"mb-4 flex items-center justify-between\">\n        <h1 className=\"text-xl font-bold\">AIÈ£ü‰∫ãÂàÜÊûê</h1>\n        {state.phase === 'result' && (\n          <button\n            onClick={handleReset}\n            className=\"text-sm text-gray-500 hover:text-gray-700\"\n          >\n            „ÇÑ„ÇäÁõ¥„Åô\n          </button>\n        )}\n      </div>\n\n      {state.phase === 'capture' && (\n        <div className=\"space-y-4\">\n          <PhotoCapture onCapture={handlePhotoCapture} onCancel={() => navigate(-1)} />\n\n          <div className=\"flex items-center gap-4\">\n            <div className=\"flex-1 border-t border-gray-300\" />\n            <span className=\"text-sm text-gray-500\">„Åæ„Åü„ÅØ</span>\n            <div className=\"flex-1 border-t border-gray-300\" />\n          </div>\n\n          <button\n            onClick={handleManualEntry}\n            className=\"w-full rounded-lg border-2 border-dashed border-gray-300 py-4 text-gray-600 hover:border-blue-400 hover:text-blue-600\"\n          >\n            ÊâãÂãï„ÅßÂÖ•Âäõ„Åô„Çã\n          </button>\n        </div>\n      )}\n\n      {state.phase === 'creating' && (\n        <div className=\"flex flex-col items-center gap-4 py-12\">\n          <div className=\"h-8 w-8 animate-spin rounded-full border-4 border-blue-500 border-t-transparent\" />\n          <p className=\"text-gray-600\">Ê∫ñÂÇô‰∏≠...</p>\n        </div>\n      )}\n\n      {state.phase === 'analyzing' && (\n        <AnalysisResult\n          foodItems={[]}\n          totals={{ calories: 0, protein: 0, fat: 0, carbs: 0 }}\n          isLoading\n        />\n      )}\n\n      {state.phase === 'error' && (\n        <div className=\"flex flex-col items-center gap-4 rounded-lg bg-red-50 p-6\">\n          <p className=\"text-red-600\">{state.message}</p>\n          <button\n            onClick={handleReset}\n            className=\"rounded bg-red-500 px-4 py-2 text-white hover:bg-red-600\"\n          >\n            „ÇÇ„ÅÜ‰∏ÄÂ∫¶ÊíÆÂΩ±„Åô„Çã\n          </button>\n        </div>\n      )}\n\n      {state.phase === 'result' && (\n        <div className=\"space-y-4\">\n          <AnalysisResult\n            photoUrl={state.photoUrl}\n            foodItems={state.foodItems}\n            totals={state.totals}\n            onUpdateItem={handleUpdateItem}\n            onDeleteItem={handleDeleteItem}\n            onAddItem={handleAddItem}\n          />\n\n          {/* Chat toggle */}\n          <button\n            onClick={() => setShowChat(!showChat)}\n            className=\"w-full rounded-lg border py-3 text-center hover:bg-gray-50\"\n          >\n            {showChat ? 'üí¨ „ÉÅ„É£„ÉÉ„Éà„ÇíÈñâ„Åò„Çã' : 'üí¨ AI„Å®Áõ∏Ë´á„Åó„Å¶Ë™øÊï¥'}\n          </button>\n\n          {showChat && (\n            <MealChat\n              mealId={state.mealId}\n              currentFoodItems={state.foodItems}\n              onUpdate={handleChatUpdate}\n            />\n          )}\n\n          {/* Save section */}\n          <div className=\"rounded-lg bg-gray-50 p-4\">\n            <h3 className=\"mb-3 font-semibold\">Ë®òÈå≤„Å®„Åó„Å¶‰øùÂ≠ò</h3>\n            <div className=\"mb-4 flex gap-2\">\n              {(['breakfast', 'lunch', 'dinner', 'snack'] as MealType[]).map((type) => (\n                <button\n                  key={type}\n                  onClick={() => setSelectedMealType(type)}\n                  className={`flex-1 rounded-lg py-2 text-sm ${\n                    selectedMealType === type\n                      ? 'bg-blue-500 text-white'\n                      : 'bg-white border hover:bg-gray-100'\n                  }`}\n                >\n                  {type === 'breakfast' && 'ÊúùÈ£ü'}\n                  {type === 'lunch' && 'ÊòºÈ£ü'}\n                  {type === 'dinner' && 'Â§ïÈ£ü'}\n                  {type === 'snack' && 'ÈñìÈ£ü'}\n                </button>\n              ))}\n            </div>\n            <button\n              onClick={handleSave}\n              disabled={isSaving || state.foodItems.length === 0}\n              className=\"w-full rounded-lg bg-blue-500 py-3 font-semibold text-white hover:bg-blue-600 disabled:opacity-50\"\n            >\n              {isSaving ? '‰øùÂ≠ò‰∏≠...' : 'È£ü‰∫ã„ÇíË®òÈå≤„Åô„Çã'}\n            </button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["PhotoCapture","onCapture","onCancel","maxSize","mode","setMode","useState","isProcessing","setIsProcessing","isVideoReady","setIsVideoReady","error","setError","videoRef","useRef","streamRef","fileInputRef","resizeImage","useCallback","file","maxDimension","resolve","reject","objectUrl","img","cleanup","scale","width","height","canvas","ctx","blob","err","handleFileSelect","event","_a","resized","logError","startCamera","stream","video","markReady","playErr","attempts","checkReady","stopCamera","track","captureFromCamera","timeout","b","jsxs","jsx","AnalysisResult","photoUrl","foodItems","totals","isLoading","onUpdateItem","onDeleteItem","onAddItem","editingId","setEditingId","showAddForm","setShowAddForm","item","FoodItemEditForm","updates","FoodItemCard","onEdit","onDelete","editable","portionLabel","onSave","name","setName","portion","setPortion","calories","setCalories","protein","setProtein","_b","fat","setFat","_c","carbs","setCarbs","_d","isSaving","setIsSaving","handleSubmit","e","MealChat","mealId","_currentFoodItems","onUpdate","toast","useToast","messages","setMessages","input","setInput","setIsLoading","pendingChanges","setPendingChanges","messagesEndRef","useEffect","history","mealAnalysisApi","msg","handleSend","userMessage","userMsgId","prev","assistantMsgId","fullContent","changes","handleApplyChanges","result","handleKeyPress","change","i","getErrorMessage","MealAnalysisPage","navigate","useNavigate","state","setState","showChat","setShowChat","selectedMealType","setSelectedMealType","handlePhotoCapture","photo","analysisResult","handleManualEntry","handleUpdateItem","itemId","handleDeleteItem","handleAddItem","handleChatUpdate","handleSave","handleReset","type"],"mappings":"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"}